enum LessonType {
  video
  text
}

enum LessonStatus {
  draft
  published
  archived
}

model Lesson {
  id          String       @id @default(cuid())
  courseId    String
  moduleId    String? // Optional - lesson can be directly under course or inside a module
  title       String
  slug        String
  type        LessonType   @default(video)
  description String?      @db.Text
  sequence    Int // Order within course or module
  duration    Int? // in minutes (calculated/cached)
  isFree      Boolean      @default(false) // Preview/free lessons
  isMandatory Boolean      @default(true)
  status      LessonStatus @default(published)
  metadata    Json?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  // Relations
  course            Course               @relation(fields: [courseId], references: [id], onDelete: Cascade)
  module            Module?              @relation(fields: [moduleId], references: [id], onDelete: Cascade)
  textLesson        TextLesson?
  videoLesson       VideoLesson?
  lessonDescription LessonDescription?
  lessonAttachments LessonAttachment[]
  lessonProgress    UserLessonProgress[]

  @@unique([courseId, slug])
  @@index([courseId])
  @@index([moduleId])
  @@index([sequence])
  @@index([status])
  @@index([type])
}

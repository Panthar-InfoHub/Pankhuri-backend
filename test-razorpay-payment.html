<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Razorpay Payment Test</title>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
          Cantarell, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
      }

      .container {
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        padding: 40px;
        max-width: 500px;
        width: 100%;
      }

      h1 {
        color: #333;
        margin-bottom: 10px;
        font-size: 28px;
      }

      .subtitle {
        color: #666;
        margin-bottom: 30px;
        font-size: 14px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      label {
        display: block;
        color: #333;
        font-weight: 600;
        margin-bottom: 8px;
        font-size: 14px;
      }

      input,
      textarea {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 14px;
        transition: border-color 0.3s;
        font-family: monospace;
      }

      input:focus,
      textarea:focus {
        outline: none;
        border-color: #667eea;
      }

      textarea {
        resize: vertical;
        min-height: 100px;
      }

      .btn {
        width: 100%;
        padding: 14px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
        margin-top: 10px;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
      }

      .btn:active {
        transform: translateY(0);
      }

      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .info-box {
        background: #f8f9fa;
        border-left: 4px solid #667eea;
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 4px;
        font-size: 13px;
        color: #555;
      }

      .info-box strong {
        color: #333;
      }

      .result {
        margin-top: 20px;
        padding: 15px;
        border-radius: 8px;
        font-size: 14px;
        display: none;
      }

      .result.success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
        display: block;
      }

      .result.error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
        display: block;
      }

      .result-data {
        background: white;
        padding: 10px;
        border-radius: 4px;
        margin-top: 10px;
        font-family: monospace;
        font-size: 12px;
        overflow-x: auto;
      }

      .test-cards {
        margin-top: 20px;
        padding: 15px;
        background: #fff3cd;
        border-radius: 8px;
        border: 1px solid #ffc107;
      }

      .test-cards h3 {
        font-size: 14px;
        color: #856404;
        margin-bottom: 10px;
      }

      .test-cards p {
        font-size: 12px;
        color: #856404;
        margin: 5px 0;
      }

      .test-cards code {
        background: white;
        padding: 2px 6px;
        border-radius: 3px;
        font-weight: 600;
      }

      .quick-fill {
        display: flex;
        gap: 10px;
        margin-top: 10px;
      }

      .quick-fill button {
        flex: 1;
        padding: 8px;
        background: #f0f0f0;
        border: 1px solid #ddd;
        border-radius: 6px;
        cursor: pointer;
        font-size: 12px;
        transition: background 0.2s;
      }

      .quick-fill button:hover {
        background: #e0e0e0;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üîê Razorpay Payment Test</h1>
      <p class="subtitle">Test paid trial payments with Razorpay checkout</p>

      <div class="info-box">
        <strong>üìã Instructions:</strong>
        <br />
        1. Create a paid trial subscription via Postman
        <br />
        2. Copy the order details from response
        <br />
        3. Paste below and click "Pay Now"
        <br />
        4. Use test card to complete payment
      </div>

      <form id="paymentForm">
        <div class="form-group">
          <label for="orderId">Order ID *</label>
          <input type="text" id="orderId" placeholder="order_xxxxxxxxxxxxx" required />
        </div>

        <div class="form-group">
          <label for="amount">Amount (in paise) *</label>
          <input type="number" id="amount" placeholder="9900" required />
          <small style="color: #666; font-size: 12px">
            ‚Çπ1 = 100 paise (e.g., ‚Çπ99 = 9900 paise)
          </small>
        </div>

        <div class="form-group">
          <label for="keyId">Razorpay Key ID *</label>
          <input type="text" id="keyId" value="rzp_test_jgBUfaw8NnKx0P" required />
        </div>

        <div class="form-group">
          <label for="userName">User Name (Optional)</label>
          <input type="text" id="userName" placeholder="Test User" />
        </div>

        <div class="form-group">
          <label for="userEmail">User Email (Optional)</label>
          <input type="email" id="userEmail" placeholder="test@example.com" />
        </div>

        <div class="form-group">
          <label for="userContact">User Contact (Optional)</label>
          <input type="tel" id="userContact" placeholder="9876543210" />
        </div>

        <div class="form-group">
          <label for="companyName">Company Name (Optional)</label>
          <input
            type="text"
            id="companyName"
            placeholder="Pankhuri Learning"
            value="Pankhuri Learning"
          />
        </div>

        <div class="form-group">
          <label for="description">Payment Description (Optional)</label>
          <input
            type="text"
            id="description"
            placeholder="Paid Trial Payment"
            value="Paid Trial Payment"
          />
        </div>

        <div class="form-group">
          <label for="themeColor">Theme Color (Optional)</label>
          <input type="color" id="themeColor" value="#667eea" />
        </div>

        <div class="quick-fill">
          <button type="button" onclick="fillSampleData()">üìù Fill Sample Data</button>
          <button type="button" onclick="clearForm()">üóëÔ∏è Clear Form</button>
        </div>

        <button type="submit" class="btn" id="payBtn">üí≥ Pay Now</button>
      </form>

      <div class="test-cards">
        <h3>üß™ Test Card Details</h3>
        <p>
          Card:
          <code>4111 1111 1111 1111</code>
        </p>
        <p>
          CVV:
          <code>Any 3 digits</code>
        </p>
        <p>
          Expiry:
          <code>Any future date</code>
        </p>
        <p>
          OTP:
          <code>1234</code>
        </p>
      </div>

      <div class="result" id="result"></div>
    </div>

    <script>
      const form = document.getElementById("paymentForm");
      const resultDiv = document.getElementById("result");
      const payBtn = document.getElementById("payBtn");

      // Fill sample data
      function fillSampleData() {
        document.getElementById("orderId").value = "order_test_12345";
        document.getElementById("amount").value = "9900";
        document.getElementById("keyId").value = "rzp_test_jgBUfaw8NnKx0P";
        document.getElementById("userName").value = "Test User";
        document.getElementById("userEmail").value = "test@example.com";
        document.getElementById("userContact").value = "9876543210";
        document.getElementById("companyName").value = "Pankhuri Learning";
        document.getElementById("description").value = "Paid Trial Payment";
        document.getElementById("themeColor").value = "#667eea";
      }

      // Clear form
      function clearForm() {
        form.reset();
        document.getElementById("keyId").value = "rzp_test_jgBUfaw8NnKx0P";
        document.getElementById("companyName").value = "Pankhuri Learning";
        document.getElementById("description").value = "Paid Trial Payment";
        document.getElementById("themeColor").value = "#667eea";
        resultDiv.style.display = "none";
      }

      // Handle form submission
      form.addEventListener("submit", function (e) {
        e.preventDefault();

        const orderId = document.getElementById("orderId").value.trim();
        const amount = parseInt(document.getElementById("amount").value);
        const keyId = document.getElementById("keyId").value.trim();
        const userName = document.getElementById("userName").value.trim();
        const userEmail = document.getElementById("userEmail").value.trim();
        const userContact = document.getElementById("userContact").value.trim();
        const companyName = document.getElementById("companyName").value.trim();
        const description = document.getElementById("description").value.trim();
        const themeColor = document.getElementById("themeColor").value;

        // Validate inputs
        if (!orderId || !amount || !keyId) {
          showResult("error", "Please fill all required fields");
          return;
        }

        if (!orderId.startsWith("order_")) {
          showResult("error", 'Invalid Order ID format. Should start with "order_"');
          return;
        }

        // Disable button
        payBtn.disabled = true;
        payBtn.textContent = "‚è≥ Opening Checkout...";

        // Configure Razorpay options
        const options = {
          key: keyId,
          amount: amount,
          currency: "INR",
          name: companyName || "Pankhuri Learning",
          description: description || "Paid Trial Payment",
          image: "https://cdn-icons-png.flaticon.com/512/2910/2910791.png",
          order_id: orderId,
          prefill: {
            name: userName || "Test User",
            email: userEmail || "test@example.com",
            contact: userContact || "9876543210",
          },
          theme: {
            color: themeColor || "#667eea",
          },
          handler: function (response) {
            // Payment successful
            const resultData = {
              razorpay_order_id: response.razorpay_order_id,
              razorpay_payment_id: response.razorpay_payment_id,
              razorpay_signature: response.razorpay_signature,
            };

            showResult(
              "success",
              "‚úÖ Payment Successful!<br><br>" +
                "<strong>Now verify this payment via Postman:</strong><br>" +
                "POST /api/subscriptions/verify-trial-payment<br><br>" +
                '<div class="result-data">' +
                "<strong>Request Body:</strong><br>" +
                JSON.stringify(
                  {
                    orderId: response.razorpay_order_id,
                    paymentId: response.razorpay_payment_id,
                    signature: response.razorpay_signature,
                  },
                  null,
                  2
                ) +
                "</div>"
            );

            // Log to console for easy copying
            console.log("Payment Response:", resultData);
            console.log(
              "Copy this for Postman verification:",
              JSON.stringify(
                {
                  orderId: response.razorpay_order_id,
                  paymentId: response.razorpay_payment_id,
                  signature: response.razorpay_signature,
                },
                null,
                2
              )
            );
          },
          modal: {
            ondismiss: function () {
              // Payment cancelled
              showResult("error", "‚ùå Payment was cancelled");
              payBtn.disabled = false;
              payBtn.textContent = "üí≥ Pay Now";
            },
          },
        };

        // Open Razorpay checkout
        try {
          const rzp = new Razorpay(options);

          rzp.on("payment.failed", function (response) {
            showResult(
              "error",
              "‚ùå Payment Failed!<br><br>" +
                '<div class="result-data">' +
                "<strong>Error:</strong><br>" +
                JSON.stringify(response.error, null, 2) +
                "</div>"
            );
            payBtn.disabled = false;
            payBtn.textContent = "üí≥ Pay Now";
            console.error("Payment Failed:", response.error);
          });

          rzp.open();

          // Re-enable button after modal opens
          setTimeout(() => {
            payBtn.disabled = false;
            payBtn.textContent = "üí≥ Pay Now";
          }, 1000);
        } catch (error) {
          showResult("error", "Failed to initialize Razorpay: " + error.message);
          payBtn.disabled = false;
          payBtn.textContent = "üí≥ Pay Now";
        }
      });

      // Show result message
      function showResult(type, message) {
        resultDiv.className = "result " + type;
        resultDiv.innerHTML = message;
        resultDiv.style.display = "block";

        // Scroll to result
        resultDiv.scrollIntoView({ behavior: "smooth", block: "nearest" });
      }

      // Auto-fill from URL parameters (if provided)
      window.addEventListener("DOMContentLoaded", function () {
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get("orderId")) {
          document.getElementById("orderId").value = urlParams.get("orderId");
        }
        if (urlParams.get("amount")) {
          document.getElementById("amount").value = urlParams.get("amount");
        }
        if (urlParams.get("keyId")) {
          document.getElementById("keyId").value = urlParams.get("keyId");
        }
      });
    </script>
  </body>
</html>
